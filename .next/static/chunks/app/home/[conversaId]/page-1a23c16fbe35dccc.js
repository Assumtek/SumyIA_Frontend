(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[213],{351:function(e,a,o){Promise.resolve().then(o.bind(o,2773))},2964:function(e,a,o){"use strict";o.d(a,{$m:function(){return p},DO:function(){return c},Ot:function(){return l},Wu:function(){return v},X7:function(){return u},hY:function(){return h},hu:function(){return s},jc:function(){return r},ju:function(){return m},nB:function(){return i},t9:function(){return t},tY:function(){return d},uP:function(){return _},vu:function(){return f},wE:function(){return g}}),o(4590);var n=o(8064),s=(0,n.$)("053e861bcea7755cfba373125f8198a5bc28c549"),r=(0,n.$)("558ad3660056be9eba7dc5f09e27878a772491c0"),t=(0,n.$)("287945dda908ddb22fdb03ede253fae1095ea2f1"),i=(0,n.$)("42ea804943d0224a9fe1ba76df099e420a780d02"),c=(0,n.$)("3a7692f6baf7ebf3ea52eb3cbc91fe93916b4570"),l=(0,n.$)("561401549378fe0ed02c0461837c6dc978112640"),d=(0,n.$)("a7b77190ebaff36ea8709b3c6e9301e682870be4"),u=(0,n.$)("e4686f9b13014677e5d5a651bf2af1e2ae6fdd2f"),m=(0,n.$)("c20d231e08389a8a6a2d33691a452c25eb5ae201"),_=(0,n.$)("bb3d8cd965a047c66119755ac4d953c0f241bec5"),v=(0,n.$)("de19785256674c246b4cf6f806603526bc77159a"),f=(0,n.$)("b4b0bbff28d81ce6efe86b38d98113027fe824dc"),h=(0,n.$)("03ea332e304d0c03b76efc6ee75984ffcf986ee0"),g=(0,n.$)("6b32acc6a7fc8cb8f70098d2055c29a48d42c646"),p=(0,n.$)("2be16bba6190616f02118aaa5ec681827adc4c79")},2773:function(e,a,o){"use strict";o.r(a),o.d(a,{default:function(){return C}});var n=o(7437),s=o(2265),r=o(6463),t=o(7138),i=o(7625),c=o.n(i),l=o(3375);function d(){return(0,l.getCookie)("session")}var u=o(2964),m=o(2513),_=o(9913),v=o(883),f=o(4258),h=o(9687),g=o(9896),p=o(2023),b=o(994);async function x(){try{return(0,l.deleteCookie)("session"),await (0,u.hY)(),!0}catch(e){return console.error("Erro ao fazer logout:",e),!1}}async function j(e,a){try{let o=a||d();if(!o)throw Error("Usu\xe1rio n\xe3o autenticado");console.log("Token de autentica\xe7\xe3o:",o),console.log("URL base:",e);let n="".concat(e,"?token=").concat(encodeURIComponent(o));console.log("URL completa:",n);let s=document.createElement("a");return s.href=n,s.style.display="none",document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s)},100),!0}catch(e){throw console.error("Erro ao baixar arquivo:",e),e}}function C(){let[e,a]=(0,s.useState)(!0),[o,i]=(0,s.useState)(null),[l,C]=(0,s.useState)([]),[N,y]=(0,s.useState)(null),[E,I]=(0,s.useState)(""),[S,k]=(0,s.useState)([]),[w,A]=(0,s.useState)(!0),[B,D]=(0,s.useState)(!1),[M,$]=(0,s.useState)(!1),[U,z]=(0,s.useState)(null),[L,O]=(0,s.useState)(null),[T,Z]=(0,s.useState)(""),[F,R]=(0,s.useState)(null),[W,P]=(0,s.useState)(!1),H=(0,r.useParams)(),q=(0,r.useRouter)(),G=(0,s.useRef)(null),X=H.conversaId;(0,s.useEffect)(()=>{(async function(){try{let e=await (0,u.nB)();e&&e.user&&z(e.user)}catch(e){console.error("Erro ao carregar dados do usu\xe1rio:",e)}})()},[]),(0,s.useEffect)(()=>{(async function(){if(X){a(!0),i(null);try{if(!d()){q.push("/");return}let e=await (0,u.Ot)(X);if(e&&e.mensagens){let a=e.mensagens.filter((e,a)=>!(a<1));C(a),y({id:X,secao:e.secao||"Conversa",mensagens:a})}else i("N\xe3o foi poss\xedvel carregar as mensagens")}catch(a){var e,o,n;console.error("Erro ao buscar mensagens:",a),i((null===(o=a.response)||void 0===o?void 0:null===(e=o.data)||void 0===e?void 0:e.message)||"Erro ao carregar a conversa"),(null===(n=a.response)||void 0===n?void 0:n.status)===401&&q.push("/")}finally{a(!1)}}})()},[X,q]),(0,s.useEffect)(()=>{(async function(){A(!0);try{let e=await (0,u.DO)();e&&Array.isArray(e)&&k(e)}catch(e){console.error("Erro ao buscar lista de conversas:",e)}finally{A(!1)}})()},[]),(0,s.useEffect)(()=>{G.current&&(G.current.scrollTop=G.current.scrollHeight)},[l]);let Y=async e=>{if(e.preventDefault(),!E.trim()||B)return;let a=E.trim();I(""),D(!0),$(!0);let o={id:"temp-".concat(Date.now()),role:"user",content:a,createdAt:new Date().toISOString()};C(e=>[...e,o]);try{if(!d()){q.push("/");return}let e=await (0,u.tY)(X,a);if(console.log("Resposta da API:",e),e&&e.pergunta){let a={id:"ia-".concat(Date.now()),role:"assistant",content:e.pergunta,createdAt:new Date().toISOString()};C(e=>[...e,a])}K()}catch(e){console.error("Erro ao enviar mensagem:",e),alert("N\xe3o foi poss\xedvel enviar a mensagem"),C(e=>e.filter(e=>e.id!==o.id))}finally{D(!1),$(!1)}},K=async()=>{try{let e=await (0,u.DO)();e&&Array.isArray(e)&&k(e)}catch(e){console.error("Erro ao atualizar lista de conversas:",e)}},Q=async()=>{try{if(!d()){q.push("/");return}console.log("Chamando handleIniciarConversa");let e=await (0,u.X7)();e&&e.conversaId&&q.push("/home/".concat(e.conversaId))}catch(e){console.error("Erro ao criar nova conversa:",e),alert("N\xe3o foi poss\xedvel criar uma nova conversa")}},V=async()=>{try{await x(),q.push("/")}catch(e){console.error("Erro ao fazer logout:",e),q.push("/")}},J=e=>{try{return new Date(e).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}catch(e){return""}},ee=async e=>{if(T.trim()&&!W){P(!0);try{await (0,u.wE)(e,T),k(a=>a.map(a=>a.id===e?{...a,secao:T}:a)),e===H.conversaId&&y(e=>e?{...e,secao:T}:null),O(null),Z("")}catch(e){console.error("Erro ao editar nome da conversa:",e),alert("N\xe3o foi poss\xedvel editar o nome da conversa")}finally{P(!1)}}},ea=async e=>{if(!W){P(!0);try{if(await (0,u.$m)(e),k(a=>a.filter(a=>a.id!==e)),e===H.conversaId){let a=S.filter(a=>a.id!==e);if(a.length>0)q.push("/home/".concat(a[0].id));else{let e=await (0,u.X7)();e&&e.conversaId&&q.push("/home/".concat(e.conversaId))}}R(null)}catch(e){console.error("Erro ao excluir conversa:",e),alert("N\xe3o foi poss\xedvel excluir a conversa")}finally{P(!1)}}},eo=async()=>{try{if(!X)return;let e=await (0,u.hu)(X);await j(e.url,e.token)}catch(e){console.error("Erro ao baixar documento:",e),alert("N\xe3o foi poss\xedvel baixar o documento Word.")}};return(0,n.jsxs)("div",{className:c().pageContainer,children:[(0,n.jsxs)("div",{className:c().sidebar,children:[(0,n.jsx)("div",{className:c().logoContainer,children:(0,n.jsx)("div",{className:c().sidebarLogo,children:(0,n.jsx)("h1",{className:c().title,children:"Sumy IA"})})}),(0,n.jsxs)("div",{className:c().userInfoContainer,onClick:()=>q.push("/profile"),children:[(0,n.jsx)("div",{className:c().userAvatar,children:U?(e=>{if(!e)return"UD";let a=e.split(" ");return 1===a.length?a[0].substring(0,2).toUpperCase():(a[0][0]+a[a.length-1][0]).toUpperCase()})(U.nome):"UD"}),(0,n.jsxs)("div",{className:c().userInfo,children:[(0,n.jsx)("h4",{children:(null==U?void 0:U.nome)||"Usu\xe1rio Demo"}),(0,n.jsx)("p",{children:(null==U?void 0:U.email)||"usuario@exemplo.com"})]})]}),(0,n.jsxs)("div",{className:c().sidebarHeader,children:[(0,n.jsx)("h3",{children:"Conversas"}),(0,n.jsxs)("button",{onClick:Q,className:c().novaConversaBtn,children:[(0,n.jsx)(m.Z,{size:18}),(0,n.jsx)("span",{className:c().btnText,children:"Nova"})]})]}),(0,n.jsx)("div",{className:c().conversasList,children:w?(0,n.jsx)("div",{className:c().carregando,children:"Carregando..."}):0===S.length?(0,n.jsx)("div",{className:c().semConversas,children:"Nenhuma conversa encontrada"}):S.map(e=>{var a,o;return(0,n.jsx)("div",{className:"".concat(c().conversaItem," ").concat(e.id===X?c().ativo:""),children:L===e.id?(0,n.jsxs)("div",{className:c().editarConversa,children:[(0,n.jsx)("input",{type:"text",value:T,onChange:e=>Z(e.target.value),className:c().inputEditarConversa,placeholder:"Nome da conversa",autoFocus:!0}),(0,n.jsxs)("div",{className:c().editarBotoes,children:[(0,n.jsx)("button",{onClick:()=>ee(e.id),className:c().botaoSalvar,disabled:W||!T.trim(),children:"Salvar"}),(0,n.jsx)("button",{onClick:()=>{O(null),Z("")},className:c().botaoCancelar,children:"Cancelar"})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.default,{href:"/home/".concat(e.id),className:c().conversaLink,children:(0,n.jsxs)("div",{className:c().conversaInfo,children:[(0,n.jsx)("h4",{children:e.secao}),(0,n.jsx)("p",{children:(null===(o=e.ultimaMensagem)||void 0===o?void 0:null===(a=o.content)||void 0===a?void 0:a.substring(0,30))||"Sem mensagens"})]})}),(0,n.jsxs)("div",{className:c().conversaAcoes,children:[(0,n.jsx)("button",{onClick:()=>{O(e.id),Z(e.secao)},className:c().botaoEditar,"aria-label":"Editar conversa",children:(0,n.jsx)(_.Z,{size:16})}),(0,n.jsx)("button",{onClick:()=>R(e.id),className:c().botaoExcluir,"aria-label":"Excluir conversa",children:(0,n.jsx)(v.Z,{size:16})})]})]})},e.id)})}),(0,n.jsxs)("div",{className:c().sidebarFooter,children:[(0,n.jsxs)("button",{className:c().footerButton,onClick:()=>q.push("/profile"),children:[(0,n.jsx)(f.Z,{size:20,className:c().footerIcon}),"Configura\xe7\xf5es"]}),(0,n.jsxs)("button",{className:c().footerButton,children:[(0,n.jsx)(h.Z,{size:20,className:c().footerIcon}),"Suporte"]}),(0,n.jsxs)("button",{className:c().footerButton,onClick:V,children:[(0,n.jsx)(g.Z,{size:20,className:c().footerIcon}),"Sair"]})]})]}),(0,n.jsxs)("div",{className:c().chatContainer,children:[(0,n.jsx)("div",{className:c().tituloAtualChat,children:(0,n.jsxs)("div",{className:c().tituloContainer,children:[(0,n.jsx)("div",{children:(null==N?void 0:N.secao)||"Carregando..."}),(0,n.jsx)("button",{onClick:eo,className:c().botaoBaixarDocumento,title:"Baixar como Word","aria-label":"Baixar como documento Word",children:(0,n.jsx)(p.Z,{size:20})})]})}),(0,n.jsx)("div",{className:c().mensagens,ref:G,children:e?(0,n.jsx)("div",{className:c().carregando,children:"Carregando mensagens..."}):o?(0,n.jsx)("div",{className:c().erro,children:o}):0===l.length?(0,n.jsx)("div",{className:c().semMensagens,children:"Nenhuma mensagem encontrada"}):(0,n.jsxs)(n.Fragment,{children:[l.map(e=>(0,n.jsxs)("div",{className:"user"===e.role?c().mensagemUser:c().mensagemIA,"data-author":"user"===e.role?(null==U?void 0:U.nome)||"Usu\xe1rio Demo":"Assistente IA",children:[(0,n.jsx)("p",{children:e.content}),(0,n.jsx)("span",{className:c().horario,children:J(e.createdAt)})]},e.id)),M&&(0,n.jsxs)("div",{className:c().digitando,children:[(0,n.jsx)("div",{className:c().bolinha}),(0,n.jsx)("div",{className:c().bolinha}),(0,n.jsx)("div",{className:c().bolinha})]})]})}),(0,n.jsxs)("form",{onSubmit:Y,className:c().enviarMensagem,children:[(0,n.jsx)("input",{type:"text",value:E,onChange:e=>I(e.target.value),placeholder:"Digite sua mensagem...",className:c().inputMensagem,disabled:e||B}),(0,n.jsx)("button",{type:"submit",className:c().botaoEnviar,disabled:e||B||!E.trim(),children:B?"Enviando...":(0,n.jsx)(b.Z,{size:22})})]})]}),F&&(0,n.jsx)("div",{className:c().modalOverlay,children:(0,n.jsxs)("div",{className:c().modalContent,children:[(0,n.jsx)("h3",{children:"Confirmar exclus\xe3o"}),(0,n.jsx)("p",{children:"Tem certeza que deseja excluir esta conversa? Esta a\xe7\xe3o n\xe3o pode ser desfeita."}),(0,n.jsxs)("div",{className:c().modalBotoes,children:[(0,n.jsx)("button",{onClick:()=>ea(F),className:c().botaoConfirmarExclusao,disabled:W,children:W?"Excluindo...":"Sim, excluir"}),(0,n.jsx)("button",{onClick:()=>R(null),className:c().botaoCancelar,disabled:W,children:"Cancelar"})]})]})})]})}},7625:function(e){e.exports={pageContainer:"page_pageContainer__t9EO9",sidebar:"page_sidebar__L5HNS",logoContainer:"page_logoContainer__Kjikl",logoTitle:"page_logoTitle__c06Ij",userInfoContainer:"page_userInfoContainer__ghQyu",userAvatar:"page_userAvatar__8fNzm",userInfo:"page_userInfo__6i9s5",sidebarHeader:"page_sidebarHeader__dalg1",novaConversaBtn:"page_novaConversaBtn__Wk7I1",btnText:"page_btnText__jwA8a",sidebarFooter:"page_sidebarFooter__y2wdf",footerButton:"page_footerButton__sQGr0",footerIcon:"page_footerIcon__S7zMn",conversasList:"page_conversasList__32Rqt",conversaItem:"page_conversaItem__7mUW_",ativo:"page_ativo__7Lx1C",conversaInfo:"page_conversaInfo__P4Str",conversaLink:"page_conversaLink__4stHV",conversaAcoes:"page_conversaAcoes__IaSwk",botaoEditar:"page_botaoEditar__TNQ5V",botaoExcluir:"page_botaoExcluir__01_bm",chatContainer:"page_chatContainer__jdo4B",tituloAtualChat:"page_tituloAtualChat__pjjFG",tituloContainer:"page_tituloContainer__NgimM",botaoBaixarDocumento:"page_botaoBaixarDocumento__ZjFKl",mensagens:"page_mensagens__hp6_V",mensagemUser:"page_mensagemUser__f06wM",mensagemIA:"page_mensagemIA__xevhU",horario:"page_horario__Aq5y_",digitando:"page_digitando__9_yOW",bolinha:"page_bolinha__4aTr_",pulsar:"page_pulsar__Z9pF_",carregando:"page_carregando__pdxZ1",erro:"page_erro__LMcMi",semMensagens:"page_semMensagens__It5PK",semConversas:"page_semConversas__ifUa5",enviarMensagem:"page_enviarMensagem__v1kFb",inputMensagem:"page_inputMensagem__7ZDzX",botaoEnviar:"page_botaoEnviar__EGGm8",editarConversa:"page_editarConversa___mR2L",inputEditarConversa:"page_inputEditarConversa__c38lZ",editarBotoes:"page_editarBotoes__RFjfp",botaoSalvar:"page_botaoSalvar__hSJ_n",botaoCancelar:"page_botaoCancelar__OEhDP",modalOverlay:"page_modalOverlay__mkDq8",modalContent:"page_modalContent__TMEB8",modalBotoes:"page_modalBotoes__WLtM2",botaoConfirmarExclusao:"page_botaoConfirmarExclusao__h_enr"}}},function(e){e.O(0,[418,291,749,971,23,744],function(){return e(e.s=351)}),_N_E=e.O()}]);