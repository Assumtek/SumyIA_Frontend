(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[213],{5:function(e,a,s){Promise.resolve().then(s.bind(s,6610))},2964:function(e,a,s){"use strict";s.d(a,{$m:function(){return h},DO:function(){return i},Ot:function(){return c},Wu:function(){return _},X7:function(){return d},hY:function(){return v},jc:function(){return r},ju:function(){return u},nB:function(){return t},t9:function(){return o},tY:function(){return l},uP:function(){return m},vu:function(){return f},wE:function(){return g}}),s(4590);var n=s(8064);(0,n.$)("98cbaed6d7eec9bf1736d433889ef759f9a5f2b9");var r=(0,n.$)("d84faf9caa15a43a027d95346862af46046db311"),o=(0,n.$)("38fdec02dbfd68837d05f2613310340917a8b5f8"),t=(0,n.$)("d1c373dd4cd712b80c799f165221e6872f585612"),i=(0,n.$)("51057fd333e9c8b53a3a8f5ab5ce3331a9398973"),c=(0,n.$)("43d6a0f2b6ea6cceb30c84d45fb93ad2f748ba1a"),l=(0,n.$)("aba7efd78057beb5cdc141e97cbc0ca20fab7f16"),d=(0,n.$)("3fe340c3d373d4eeafef4fb0900e4ffdf9985f97"),u=(0,n.$)("dde0c68fc34512e5cb0de7adb2a83b3fd03d16af"),m=(0,n.$)("fe12400101fa1553ba608d01fb130bcb00aed57a"),_=(0,n.$)("8e373b6eadadb7c847e1f6f0b6e5e8fe482a9389"),f=(0,n.$)("1112886395d22cd4915b7f01900c05df9b13ea37"),v=(0,n.$)("6288753f177e3717d7b7c183550e24a1be30beda"),g=(0,n.$)("f774b3796d001210d3a10f999698583484e4fd48"),h=(0,n.$)("36fae22b2ab568dcfd6a8fcf490107fe15a0d39b")},6610:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return N}});var n=s(7437),r=s(2265),o=s(6463),t=s(7138),i=s(7625),c=s.n(i),l=s(3375);function d(){return(0,l.getCookie)("session")}var u=s(2964),m=s(2513),_=s(9913),f=s(883),v=s(4258),g=s(9687),h=s(9896),p=s(994);async function b(){try{return(0,l.deleteCookie)("session"),await (0,u.hY)(),!0}catch(e){return console.error("Erro ao fazer logout:",e),!1}}var x=s(2266),j=s(7485);function C(e){let{texto:a="Carregando..."}=e;return(0,n.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(255,255,255,0.9)",zIndex:9999,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,n.jsx)(j.VF,{height:100,width:100,color:"#0F62FE",secondaryColor:"#0F62FE",radius:12.5,ariaLabel:"mutating-dots-loading",visible:!0}),(0,n.jsx)("h2",{style:{marginTop:24},children:a})]})}function N(){let[e,a]=(0,r.useState)(!1),[s,i]=(0,r.useState)(!1),[l,j]=(0,r.useState)(null),[N,y]=(0,r.useState)([]),[E,I]=(0,r.useState)(null),[S,k]=(0,r.useState)(""),[w,A]=(0,r.useState)([]),[B,D]=(0,r.useState)(!0),[M,$]=(0,r.useState)(!1),[F,z]=(0,r.useState)(!1),[L,O]=(0,r.useState)(null),[T,U]=(0,r.useState)(null),[Z,H]=(0,r.useState)(""),[P,R]=(0,r.useState)(null),[W,q]=(0,r.useState)(!1),G=(0,o.useParams)(),V=(0,o.useRouter)(),X=(0,r.useRef)(null),Y=G.conversaId;(0,r.useEffect)(()=>{(async function(){try{let e=await (0,u.nB)();e&&e.user&&O(e.user)}catch(e){console.error("Erro ao carregar dados do usu\xe1rio:",e)}})()},[]),(0,r.useEffect)(()=>{(async function(){if(Y){a(!0),j(null);try{if(!d()){V.push("/");return}let e=await (0,u.Ot)(Y);if(e&&e.mensagens){let a=e.mensagens.filter((e,a)=>!(a<1));y(a),I({id:Y,secao:e.secao||"Conversa",mensagens:a})}else j("N\xe3o foi poss\xedvel carregar as mensagens")}catch(a){var e,s,n;console.error("Erro ao buscar mensagens:",a),j((null===(s=a.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"Erro ao carregar a conversa"),(null===(n=a.response)||void 0===n?void 0:n.status)===401&&V.push("/")}finally{a(!1)}}})()},[Y,V]),(0,r.useEffect)(()=>{(async function(){D(!0);try{let e=await (0,u.DO)();e&&Array.isArray(e)&&A(e)}catch(e){console.error("Erro ao buscar lista de conversas:",e)}finally{D(!1)}})()},[]),(0,r.useEffect)(()=>{X.current&&(X.current.scrollTop=X.current.scrollHeight)},[N]);let K=async e=>{if(e.preventDefault(),!S.trim()||M)return;let a=S.trim();k(""),$(!0),z(!0);let s={id:"temp-".concat(Date.now()),role:"user",content:a,createdAt:new Date().toISOString()};y(e=>[...e,s]);try{if(!d()){V.push("/");return}let e=await (0,u.tY)(Y,a);if(console.log("Resposta da API:",e),e&&e.pergunta){let a={id:"ia-".concat(Date.now()),role:"assistant",content:e.pergunta,createdAt:new Date().toISOString()};y(e=>[...e,a])}Q()}catch(e){console.error("Erro ao enviar mensagem:",e),alert("N\xe3o foi poss\xedvel enviar a mensagem"),y(e=>e.filter(e=>e.id!==s.id))}finally{$(!1),z(!1)}},Q=async()=>{try{let e=await (0,u.DO)();e&&Array.isArray(e)&&A(e)}catch(e){console.error("Erro ao atualizar lista de conversas:",e)}},J=async()=>{try{if(i(!0),!d()){V.push("/"),i(!1);return}let e=await (0,u.X7)("Nova Conversa");e&&e.conversaId&&V.push("/home/".concat(e.conversaId)),i(!1)}catch(e){alert("N\xe3o foi poss\xedvel criar uma nova conversa")}},ee=async()=>{try{await b(),V.push("/")}catch(e){console.error("Erro ao fazer logout:",e),V.push("/")}},ea=e=>{try{return new Date(e).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}catch(e){return""}},es=async e=>{if(Z.trim()&&!W){q(!0);try{await (0,u.wE)(e,Z),A(a=>a.map(a=>a.id===e?{...a,secao:Z}:a)),e===G.conversaId&&I(e=>e?{...e,secao:Z}:null),U(null),H("")}catch(e){console.error("Erro ao editar nome da conversa:",e),alert("N\xe3o foi poss\xedvel editar o nome da conversa")}finally{q(!1)}}},en=async e=>{if(!W){q(!0);try{if(await (0,u.$m)(e),A(a=>a.filter(a=>a.id!==e)),e===G.conversaId){let a=w.filter(a=>a.id!==e);if(a.length>0)V.push("/home/".concat(a[0].id));else{let e=await (0,u.X7)("Nova Conversa");e&&e.conversaId&&V.push("/home/".concat(e.conversaId))}}R(null)}catch(e){console.error("Erro ao excluir conversa:",e),alert("N\xe3o foi poss\xedvel excluir a conversa")}finally{q(!1)}}};return(0,n.jsxs)("div",{className:c().pageContainer,children:[(0,n.jsxs)("div",{className:c().sidebar,children:[(0,n.jsx)("div",{className:c().logoContainer,children:(0,n.jsx)("div",{className:c().sidebarLogo,children:(0,n.jsx)("h1",{className:c().title,children:"Sumy IA"})})}),(0,n.jsxs)("div",{className:c().userInfoContainer,onClick:()=>V.push("/profile"),children:[(0,n.jsx)("div",{className:c().userAvatar,children:L?(e=>{if(!e)return"UD";let a=e.split(" ");return 1===a.length?a[0].substring(0,2).toUpperCase():(a[0][0]+a[a.length-1][0]).toUpperCase()})(L.nome):"UD"}),(0,n.jsxs)("div",{className:c().userInfo,children:[(0,n.jsx)("h4",{children:(null==L?void 0:L.nome)||"Usu\xe1rio Demo"}),(0,n.jsx)("p",{children:(null==L?void 0:L.email)||"usuario@exemplo.com"})]})]}),(0,n.jsxs)("div",{className:c().sidebarHeader,children:[(0,n.jsx)("h3",{children:"Conversas"}),(0,n.jsxs)("button",{onClick:J,className:c().novaConversaBtn,children:[(0,n.jsx)(m.Z,{size:18}),(0,n.jsx)("span",{className:c().btnText,children:"Nova"})]})]}),(0,n.jsx)("div",{className:c().conversasList,children:B?(0,n.jsx)("div",{className:c().carregando,children:"Carregando..."}):0===w.length?(0,n.jsx)("div",{className:c().semConversas,children:"Nenhuma conversa encontrada"}):w.map(e=>{var a,s;return(0,n.jsx)("div",{className:"".concat(c().conversaItem," ").concat(e.id===Y?c().ativo:""),children:T===e.id?(0,n.jsxs)("div",{className:c().editarConversa,children:[(0,n.jsx)("input",{type:"text",value:Z,onChange:e=>H(e.target.value),className:c().inputEditarConversa,placeholder:"Nome da conversa",autoFocus:!0}),(0,n.jsxs)("div",{className:c().editarBotoes,children:[(0,n.jsx)("button",{onClick:()=>es(e.id),className:c().botaoSalvar,disabled:W||!Z.trim(),children:"Salvar"}),(0,n.jsx)("button",{onClick:()=>{U(null),H("")},className:c().botaoCancelar,children:"Cancelar"})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.default,{href:"/home/".concat(e.id),className:c().conversaLink,children:(0,n.jsxs)("div",{className:c().conversaInfo,children:[(0,n.jsx)("h4",{children:e.secao}),(0,n.jsx)("p",{children:(null===(s=e.ultimaMensagem)||void 0===s?void 0:null===(a=s.content)||void 0===a?void 0:a.substring(0,30))||"Sem mensagens"})]})}),(0,n.jsxs)("div",{className:c().conversaAcoes,children:[(0,n.jsx)("button",{onClick:()=>{U(e.id),H(e.secao)},className:c().botaoEditar,"aria-label":"Editar conversa",children:(0,n.jsx)(_.Z,{size:16})}),(0,n.jsx)("button",{onClick:()=>R(e.id),className:c().botaoExcluir,"aria-label":"Excluir conversa",children:(0,n.jsx)(f.Z,{size:16})})]})]})},e.id)})}),(0,n.jsxs)("div",{className:c().sidebarFooter,children:[(0,n.jsxs)("button",{className:c().footerButton,onClick:()=>V.push("/profile"),children:[(0,n.jsx)(v.Z,{size:20,className:c().footerIcon}),"Configura\xe7\xf5es"]}),(0,n.jsxs)("button",{className:c().footerButton,children:[(0,n.jsx)(g.Z,{size:20,className:c().footerIcon}),"Suporte"]}),(0,n.jsxs)("button",{className:c().footerButton,onClick:ee,children:[(0,n.jsx)(h.Z,{size:20,className:c().footerIcon}),"Sair"]})]})]}),(0,n.jsxs)("div",{className:c().chatContainer,children:[(0,n.jsx)("div",{className:c().tituloAtualChat,children:(0,n.jsx)("div",{className:c().tituloContainer,children:(0,n.jsx)("div",{children:(null==E?void 0:E.secao)||"Carregando..."})})}),(0,n.jsx)("div",{className:c().mensagens,ref:X,children:e?(0,n.jsx)("div",{className:c().carregando,children:"Carregando mensagens..."}):l?(0,n.jsx)("div",{className:c().erro,children:l}):0===N.length?(0,n.jsx)("div",{className:c().semMensagens,children:"Nenhuma mensagem encontrada"}):(0,n.jsxs)(n.Fragment,{children:[N.map(e=>(0,n.jsxs)("div",{className:"user"===e.role?c().mensagemUser:c().mensagemIA,"data-author":"user"===e.role?(null==L?void 0:L.nome)||"Usu\xe1rio Demo":"Assistente IA",children:["user"===e.role?(0,n.jsx)("p",{children:e.content}):(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:x.TU.parse(e.content)}}),(0,n.jsx)("span",{className:c().horario,children:ea(e.createdAt)})]},e.id)),F&&(0,n.jsxs)("div",{className:c().digitando,children:[(0,n.jsx)("div",{className:c().bolinha}),(0,n.jsx)("div",{className:c().bolinha}),(0,n.jsx)("div",{className:c().bolinha})]})]})}),(0,n.jsxs)("form",{onSubmit:K,className:c().enviarMensagem,children:[(0,n.jsx)("input",{type:"text",value:S,onChange:e=>k(e.target.value),placeholder:"Digite sua mensagem...",className:c().inputMensagem,disabled:e||M}),(0,n.jsx)("button",{type:"submit",className:c().botaoEnviar,disabled:e||M||!S.trim(),children:M?"Enviando...":(0,n.jsx)(p.Z,{size:22})})]})]}),P&&(0,n.jsx)("div",{className:c().modalOverlay,children:(0,n.jsxs)("div",{className:c().modalContent,children:[(0,n.jsx)("h3",{children:"Confirmar exclus\xe3o"}),(0,n.jsx)("p",{children:"Tem certeza que deseja excluir esta conversa? Esta a\xe7\xe3o n\xe3o pode ser desfeita."}),(0,n.jsxs)("div",{className:c().modalBotoes,children:[(0,n.jsx)("button",{onClick:()=>en(P),className:c().botaoConfirmarExclusao,disabled:W,children:W?"Excluindo...":"Sim, excluir"}),(0,n.jsx)("button",{onClick:()=>R(null),className:c().botaoCancelar,disabled:W,children:"Cancelar"})]})]})}),e&&(0,n.jsx)(C,{texto:"Carregando mensagens..."}),s&&(0,n.jsx)(C,{texto:"Sua nova conversa est\xe1 sendo criada..."})]})}},7625:function(e){e.exports={pageContainer:"page_pageContainer__t9EO9",sidebar:"page_sidebar__L5HNS",logoContainer:"page_logoContainer__Kjikl",logoTitle:"page_logoTitle__c06Ij",userInfoContainer:"page_userInfoContainer__ghQyu",userAvatar:"page_userAvatar__8fNzm",userInfo:"page_userInfo__6i9s5",sidebarHeader:"page_sidebarHeader__dalg1",novaConversaBtn:"page_novaConversaBtn__Wk7I1",btnText:"page_btnText__jwA8a",sidebarFooter:"page_sidebarFooter__y2wdf",footerButton:"page_footerButton__sQGr0",footerIcon:"page_footerIcon__S7zMn",conversasList:"page_conversasList__32Rqt",conversaItem:"page_conversaItem__7mUW_",ativo:"page_ativo__7Lx1C",conversaInfo:"page_conversaInfo__P4Str",conversaLink:"page_conversaLink__4stHV",conversaAcoes:"page_conversaAcoes__IaSwk",botaoEditar:"page_botaoEditar__TNQ5V",botaoExcluir:"page_botaoExcluir__01_bm",chatContainer:"page_chatContainer__jdo4B",tituloAtualChat:"page_tituloAtualChat__pjjFG",tituloContainer:"page_tituloContainer__NgimM",botaoBaixarDocumento:"page_botaoBaixarDocumento__ZjFKl",mensagens:"page_mensagens__hp6_V",mensagemUser:"page_mensagemUser__f06wM",mensagemIA:"page_mensagemIA__xevhU",horario:"page_horario__Aq5y_",digitando:"page_digitando__9_yOW",bolinha:"page_bolinha__4aTr_",pulsar:"page_pulsar__Z9pF_",carregando:"page_carregando__pdxZ1",erro:"page_erro__LMcMi",semMensagens:"page_semMensagens__It5PK",semConversas:"page_semConversas__ifUa5",enviarMensagem:"page_enviarMensagem__v1kFb",inputMensagem:"page_inputMensagem__7ZDzX",botaoEnviar:"page_botaoEnviar__EGGm8",editarConversa:"page_editarConversa___mR2L",inputEditarConversa:"page_inputEditarConversa__c38lZ",editarBotoes:"page_editarBotoes__RFjfp",botaoSalvar:"page_botaoSalvar__hSJ_n",botaoCancelar:"page_botaoCancelar__OEhDP",modalOverlay:"page_modalOverlay__mkDq8",modalContent:"page_modalContent__TMEB8",modalBotoes:"page_modalBotoes__WLtM2",botaoConfirmarExclusao:"page_botaoConfirmarExclusao__h_enr"}}},function(e){e.O(0,[418,571,291,116,971,23,744],function(){return e(e.s=5)}),_N_E=e.O()}]);